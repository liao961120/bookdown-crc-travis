language: r
dist: trusty
sudo: true
branches:
  only:
    - master


latex: true
pandoc_version: 2.3.1
before_install:
  - sudo apt-get update
  - tlmgr install index unicode-math filehook lm-math newunicodechar natbib
r_packages:
  - bookdown
  - ggplot2
r_github_packages:
  - r-lib/pkgdown
cache:
  packages: yes


### Where you check package
### If commands here throw errors, travis build will fail
script:
  - echo "Hi"  # This let me skip the default R CMD check
after_success:
  - R -e 'options(tinytex.verbose = TRUE); bookdown::render_book("index.Rmd", output_format = "bookdown::pdf_book")'
  - R -e 'bookdown::render_book("index.Rmd", output_format = "bookdown::gitbook")'
  - if [[ -d docs ]]; then rm -r docs; fi
  - mkdir docs
  - cp -r _book/* docs


# deploy `docs/` on branch:master to branch:gh-pages
deploy:
  - provider: pages     # Deploy to GitHub
    github-token: $GH_TOKEN  # personal access token
    skip-cleanup: true  # true, to keep the build results
    keep-history: false  # keep commit history on deployed branch?
    local-dir: docs  # dir to deploy after build
    on:
      branch: master  # Usaually set to the default branch of the repo
